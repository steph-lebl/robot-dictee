<!DOCTYPE html>
<html>
<head>
  <title>Robot dictée</title>
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/knockout/3.5.1/knockout-latest.min.js"></script>
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/linq.js/2.2.0.2/linq.min.js"></script>

  <script type="text/javascript" src="robotDictee.js"></script>
  <script type="text/javascript" src="util.js"></script>
  <script type="text/javascript" src="config.js"></script>

  <script type="text/javascript" src="viewModel.js"></script>
  <script type="text/javascript" src="dictation.js"></script>
  <script type="text/javascript" src="paragraph.js"></script>
  <script type="text/javascript" src="segment.js"></script>
  <script type="text/javascript" src="word.js"></script>
  <script type="text/javascript" src="speechSynthesisTextToSpeechEngine.js"></script>
  <script type="text/javascript" src="predefinedDictations.js"></script>
  
  <LINK type="text/css" href="robotDictee.css" rel="stylesheet" >

    <link rel="manifest" href="manifest.json" />
    <!-- include PWACompat _after_ your manifest -->
    <script async src="https://cdn.jsdelivr.net/npm/pwacompat@2.0.9/pwacompat.min.js"
        integrity="sha384-VcI6S+HIsE80FVM1jgbd6WDFhzKYA0PecD/LcIyMQpT4fMJdijBh0I7Iblaacawc"
        crossorigin="anonymous"></script>

  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
</head>
<body>
  <h1><a class="title-link" href="./index.html">Robot dictée</a></h1>

  <form name="create-dictation-form" id="create-dictation-form" data-bind="submit: createDictation, ifnot:dictation()">
    <h3>Dictées</h3>

    <div data-bind="foreach: predefinedDictations">
      <!-- ko if: $index() > 0 -->|<!-- /ko -->
      <a href="" data-bind="text: title, click: $parent.usePredefinedDictation"></a>
    </div>

    <h3>Dictée sur mesure</h3>
    <textarea name="dictation-text" data-bind='textInput: newDictationText'></textarea>
    <button data-bind="enable: newDictationText()" type="submit">Créer</button>
  </form>


  <form name="typing-form" id="typing-form" onkeypress="return robotDictee.viewModel.onKeyPress(event)" data-bind="if:dictation()">

    <div data-bind='foreach: dictation().paragraphs()'>
      <div class="paragraph" data-bind='foreach: words()'>
        <!-- ko if: isCommitted() -->
          <!-- ko if:isMistake() -->
          <table class="mistake">
            <tbody>
              <tr>
                <td class="expected" data-bind="text:expected()"></td>
              </tr>
              <tr>
                <td class="actual" data-bind="text:actual()"></td>
              </tr>
            </tbody>
          </table>
          <!-- /ko -->

          <!-- ko ifnot:isMistake() -->
            <!-- ko text: actual() -->
            <!-- /ko -->
          <!-- /ko -->
        <!-- /ko -->
      </div>
    </div>      

    <input type="text" name="currentWordText" autofocus data-bind='textInput: currentWordText, visible:dictation().isFinished()===false'/>

    <div data-bind='if:dictation().isFinished()'>
      <hr>
      <div>
        <!-- ko if:dictation().noMistakes() -->
        Sans fautes!
        <!-- /ko -->

        <!-- ko if:dictation().noMistakes() === false -->
          <!-- ko if:dictation().avgNumOfWordsForOneMistake()>1 -->
          En moyenne une faute chaque 
          <span data-bind="text:dictation().avgNumOfWordsForOneMistake()"></span> 
          mots.
          <!-- /ko -->
          
          <!-- ko if:dictation().avgNumOfWordsForOneMistake()===1 -->
          Aucun mot écrit correctement.
          <!-- /ko -->
        <!-- /ko -->
      </div>
      <a href="./index.html">Recommencer</a>
    </div>
  </form>


  <script type="text/javascript" src="main.js"></script>

</body>
</html>